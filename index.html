<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Herramientas de ELE</title>
    <meta name="description" content="Colecci√≥n de minijuegos interactivos para practicar espa√±ol como lengua extranjera.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Darumadrop+One&family=Knewave&family=Montserrat:wght@400;700&family=Zain:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-actions">
                <div class="theme-toggle">
                    <button class="theme-btn" type="button" aria-pressed="false">
                        <span class="theme-btn-label sr-only">Modo noche</span>
                        <span class="sun-icon" aria-hidden="true">‚òÄÔ∏è</span>
                        <span class="moon-icon" aria-hidden="true">üåô</span>
                    </button>
                </div>
                <div class="language-toggle">
                    <button class="lang-btn" type="button" aria-label="Cambiar a ingl√©s">English</button>
                </div>
            </div>
            <h1 class="main-title">Mis Herramientas de ELE</h1>
            <p class="subtitle" data-i18n-key="subtitle">Una colecci√≥n creciente de minijuegos para practicar espa√±ol paso a paso.</p>
        </header>

        <section class="controls" aria-label="Controles de filtrado">
            <div class="filters" role="toolbar" aria-label="Filtros de recursos">
                <span class="filter-label" data-i18n-key="filterLabel">Filtrar por tipo</span>
                <div class="filter-buttons" role="group" aria-label="Tipos de recurso">
                    <button class="filter-btn active" type="button" data-filter="all" aria-pressed="true" data-i18n-key="filterAll">Todos</button>
                    <button class="filter-btn" type="button" data-filter="exercise" aria-pressed="false" data-i18n-key="filterExercises">Ejercicios</button>
                    <button class="filter-btn" type="button" data-filter="reading" aria-pressed="false" data-i18n-key="filterReadings">Lecturas</button>
                    <button class="filter-btn" type="button" data-filter="game" aria-pressed="false" data-i18n-key="filterGames">Juegos</button>
                </div>
            </div>
        </section>

        <main class="tools-grid grid-view"></main>

        <div class="empty-state" hidden></div>

        <footer class="footer">
            <p class="footer-text" data-i18n-key="footer">Creado con ‚ù§Ô∏è para mis estudiantes de espa√±ol.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const translations = {
                es: {
                    mainTitle: 'Mis Herramientas de ELE',
                    subtitle: 'Una colecci√≥n creciente de minijuegos para practicar espa√±ol paso a paso.',
                    filterLabel: 'Filtrar por tipo',
                    filterAll: 'Todos',
                    filterExercises: 'Ejercicios',
                    filterReadings: 'Lecturas',
                    filterGames: 'Juegos',
                    noResults: 'No hay recursos disponibles para este filtro todav√≠a. ¬°Pronto habr√° m√°s!',
                    loading: 'Cargando recursos...',
                    loadError: 'No se pudieron cargar los recursos. Int√©ntalo de nuevo m√°s tarde.',
                    visitButton: 'Abrir recurso',
                    addedOn: 'A√±adido:',
                    coursesLabel: 'Cursos:',
                    footer: 'Creado con ‚ù§Ô∏è para mis estudiantes de espa√±ol.',
                    languageButton: 'English',
                    languageButtonAria: 'Cambiar a ingl√©s',
                    themeButtonNight: 'Modo noche',
                    themeButtonDay: 'Modo d√≠a',
                    themeButtonNightAria: 'Activar modo noche',
                    themeButtonDayAria: 'Activar modo d√≠a'
                },
                en: {
                    mainTitle: 'My ELE Toolkit',
                    subtitle: 'A growing collection of mini games to practice Spanish step by step.',
                    filterLabel: 'Filter by type',
                    filterAll: 'All',
                    filterExercises: 'Exercises',
                    filterReadings: 'Readings',
                    filterGames: 'Games',
                    noResults: 'No resources match this filter yet. More activities are coming soon!',
                    loading: 'Loading resources...',
                    loadError: 'We could not load the resources. Please try again later.',
                    visitButton: 'Open resource',
                    addedOn: 'Added:',
                    coursesLabel: 'Courses:',
                    footer: 'Created with ‚ù§Ô∏è for my Spanish students.',
                    languageButton: 'Espa√±ol',
                    languageButtonAria: 'Switch to Spanish',
                    themeButtonNight: 'Night mode',
                    themeButtonDay: 'Day mode',
                    themeButtonNightAria: 'Enable night mode',
                    themeButtonDayAria: 'Enable day mode'
                }
            };

            const state = {
                lang: 'es',
                filter: 'all',
                tools: [],
                isLoading: true,
                error: false,
                theme: 'light'
            };

            const CATEGORY_MAP = {
                game: 'game',
                resource: 'reading',
                'interactive practice': 'exercise',
                'interactive activity': 'exercise'
            };

            const titleEl = document.querySelector('.main-title');
            const langToggle = document.querySelector('.lang-btn');
            const themeToggle = document.querySelector('.theme-btn');
            const themeToggleLabel = themeToggle ? themeToggle.querySelector('.theme-btn-label') : null;
            const filterButtons = document.querySelectorAll('.filter-btn');
            const toolsGrid = document.querySelector('.tools-grid');
            const emptyState = document.querySelector('.empty-state');
            const i18nElements = document.querySelectorAll('[data-i18n-key]');

            const THEME_STORAGE_KEY = 'preferred-theme';

            const renderTitle = (text) => {
                if (!titleEl) return;
                titleEl.innerHTML = '';
                titleEl.setAttribute('aria-label', text);

                const words = text.split(' ');
                words.forEach((word, wordIndex) => {
                    const wordSpan = document.createElement('span');
                    wordSpan.className = 'title-word';

                    Array.from(word).forEach((char) => {
                        const letterSpan = document.createElement('span');
                        letterSpan.className = 'title-letter';
                        letterSpan.textContent = char;
                        wordSpan.appendChild(letterSpan);
                    });

                    titleEl.appendChild(wordSpan);

                    if (wordIndex < words.length - 1) {
                        const spaceSpan = document.createElement('span');
                        spaceSpan.className = 'title-letter space';
                        spaceSpan.setAttribute('aria-hidden', 'true');
                        spaceSpan.textContent = ' ';
                        titleEl.appendChild(spaceSpan);
                    }
                });
            };

            const updateThemeToggleCopy = () => {
                if (!themeToggle) {
                    return;
                }

                const copy = translations[state.lang];
                if (!copy) {
                    return;
                }

                const isDark = state.theme === 'dark';
                const labelText = isDark ? copy.themeButtonDay : copy.themeButtonNight;
                const ariaLabel = isDark ? copy.themeButtonDayAria : copy.themeButtonNightAria;

                themeToggle.setAttribute('aria-label', ariaLabel);
                themeToggle.setAttribute('aria-pressed', String(isDark));

                if (themeToggleLabel) {
                    themeToggleLabel.textContent = labelText;
                }
            };

            const applyTheme = () => {
                if (state.theme === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                } else {
                    document.documentElement.removeAttribute('data-theme');
                }

                updateThemeToggleCopy();
            };

            const formatDate = (isoDate) => {
                if (!isoDate) {
                    return '';
                }

                const date = new Date(isoDate);
                if (Number.isNaN(date.getTime())) {
                    return '';
                }

                return new Intl.DateTimeFormat(state.lang, {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                }).format(date);
            };

            const getCategoryFromTool = (tool) => {
                const typeValue = (tool?.type?.en || tool?.type?.es || '').toLowerCase().trim();
                return CATEGORY_MAP[typeValue] || 'exercise';
            };

            const createToolCard = (tool) => {
                const copy = translations[state.lang];
                const subjects = tool?.subjects?.[state.lang] || tool?.subjects?.en || [];
                const card = document.createElement('article');
                card.className = 'tool-card';
                card.dataset.category = getCategoryFromTool(tool);

                const header = document.createElement('div');
                header.className = 'tool-header';

                const headerInfo = document.createElement('div');

                const title = document.createElement('h3');
                title.className = 'tool-title';
                title.textContent = tool?.title || '';

                const meta = document.createElement('div');
                meta.className = 'tool-meta';

                const typeSpan = document.createElement('span');
                typeSpan.className = 'tool-type';
                typeSpan.textContent = tool?.type?.[state.lang] || tool?.type?.en || '';
                if (typeSpan.textContent) {
                    meta.appendChild(typeSpan);
                }

                const formattedDate = formatDate(tool?.dateAdded);
                if (formattedDate) {
                    const dateSpan = document.createElement('span');
                    dateSpan.className = 'tool-date';
                    dateSpan.textContent = `${translations[state.lang].addedOn} ${formattedDate}`;
                    meta.appendChild(dateSpan);
                }

                headerInfo.appendChild(title);
                if (meta.childNodes.length > 0) {
                    headerInfo.appendChild(meta);
                }

                header.appendChild(headerInfo);
                card.appendChild(header);

                if (tool?.description) {
                    const description = document.createElement('p');
                    description.className = 'tool-description';
                    description.innerHTML = tool.description[state.lang] || tool.description.en || '';
                    card.appendChild(description);
                }

                if (Array.isArray(subjects) && subjects.length > 0) {
                    const tagsWrapper = document.createElement('div');
                    tagsWrapper.className = 'tool-tags';

                    const labelTag = document.createElement('span');
                    labelTag.className = 'tag label';
                    labelTag.textContent = copy.coursesLabel;
                    tagsWrapper.appendChild(labelTag);

                    subjects.forEach((subject) => {
                        const subjectTag = document.createElement('span');
                        subjectTag.className = 'tag subject';
                        subjectTag.textContent = subject;
                        tagsWrapper.appendChild(subjectTag);
                    });

                    card.appendChild(tagsWrapper);
                }

                const footer = document.createElement('div');
                footer.className = 'tool-footer';

                const visitBtn = document.createElement('a');
                visitBtn.className = 'visit-btn';
                visitBtn.href = tool?.link || '#';
                visitBtn.target = '_blank';
                visitBtn.rel = 'noopener noreferrer';
                visitBtn.textContent = copy.visitButton;

                footer.appendChild(visitBtn);
                card.appendChild(footer);

                return card;
            };

            const renderTools = () => {
                if (!toolsGrid) {
                    return;
                }

                toolsGrid.innerHTML = '';

                const fragment = document.createDocumentFragment();
                state.tools.forEach((tool) => {
                    fragment.appendChild(createToolCard(tool));
                });

                toolsGrid.appendChild(fragment);
            };

            const updateEmptyState = (visibleCount = 0) => {
                if (!emptyState) {
                    return;
                }

                const copy = translations[state.lang];
                if (!copy) {
                    return;
                }

                if (state.isLoading) {
                    emptyState.hidden = false;
                    emptyState.textContent = copy.loading;
                    return;
                }

                if (state.error) {
                    emptyState.hidden = false;
                    emptyState.textContent = copy.loadError;
                    return;
                }

                if (!state.tools.length) {
                    emptyState.hidden = false;
                    emptyState.textContent = copy.noResults;
                    return;
                }

                if (visibleCount === 0) {
                    emptyState.hidden = false;
                    emptyState.textContent = copy.noResults;
                } else {
                    emptyState.hidden = true;
                }
            };

            const applyFilter = () => {
                const cards = toolsGrid ? toolsGrid.querySelectorAll('.tool-card') : [];
                let visibleCount = 0;

                cards.forEach((card) => {
                    const categories = (card.dataset.category || '').split(/\s+/).filter(Boolean);
                    const matches = state.filter === 'all' || categories.includes(state.filter);

                    card.classList.toggle('is-hidden', !matches);

                    if (matches) {
                        visibleCount += 1;
                    }
                });

                updateEmptyState(visibleCount);
            };

            const applyTranslations = () => {
                const copy = translations[state.lang];
                if (!copy) {
                    return;
                }

                renderTitle(copy.mainTitle);

                updateThemeToggleCopy();

                i18nElements.forEach((el) => {
                    const key = el.dataset.i18nKey;
                    if (!key || !(key in copy)) {
                        return;
                    }

                    const mode = el.dataset.i18nMode || 'text';
                    if (mode === 'html') {
                        el.innerHTML = copy[key];
                    } else {
                        el.textContent = copy[key];
                    }
                });

                if (langToggle) {
                    langToggle.textContent = copy.languageButton;
                    langToggle.setAttribute('aria-label', copy.languageButtonAria);
                }

                document.documentElement.lang = state.lang;
                document.documentElement.dataset.lang = state.lang;

                renderTools();
                applyFilter();
            };

            filterButtons.forEach((button) => {
                button.addEventListener('click', () => {
                    state.filter = button.dataset.filter || 'all';

                    filterButtons.forEach((btn) => {
                        const isActive = btn === button;
                        btn.classList.toggle('active', isActive);
                        btn.setAttribute('aria-pressed', String(isActive));
                    });

                    applyFilter();
                });
            });

            if (langToggle) {
                langToggle.addEventListener('click', () => {
                    state.lang = state.lang === 'es' ? 'en' : 'es';
                    applyTranslations();
                });
            }

            const storedTheme = localStorage.getItem(THEME_STORAGE_KEY);
            const prefersDarkScheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            const initialTheme = storedTheme === 'dark' || storedTheme === 'light'
                ? storedTheme
                : (prefersDarkScheme ? 'dark' : 'light');

            state.theme = initialTheme;

            if (themeToggle) {
                themeToggle.addEventListener('click', () => {
                    state.theme = state.theme === 'dark' ? 'light' : 'dark';
                    localStorage.setItem(THEME_STORAGE_KEY, state.theme);
                    applyTheme();
                });
            }

            const fetchTools = async () => {
                try {
                    state.isLoading = true;
                    state.error = false;
                    updateEmptyState();

                    const response = await fetch('tools.json');
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }

                    const data = await response.json();
                    state.tools = Array.isArray(data?.tools) ? data.tools : [];
                    state.isLoading = false;
                    state.error = false;
                } catch (error) {
                    console.error('Error loading tools:', error);
                    state.tools = [];
                    state.isLoading = false;
                    state.error = true;
                }

                renderTools();
                applyFilter();
            };

            applyTheme();
            applyTranslations();
            fetchTools();
        });
    </script>
</body>
</html>
